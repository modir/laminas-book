<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://modir.github.io/laminas-book/session/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Working with Sessions - Using Laminas Framework</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Working with Sessions";
        var mkdocs_page_input_path = "session.md";
        var mkdocs_page_url = "/laminas-book/session/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Using Laminas Framework
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Preface</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../intro/">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../acknowledgments/">Acknowledgments</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../intro/">Introduction to Laminas Framework</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../skeleton/">Laminas Skeleton Application</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../operation/">Website Operation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../mvc/">Model-View-Controller</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../routing/">Routing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../appearance/">Page Appearance and Layout</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../forms/">Collecting User Input with Forms</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../filters/">Transforming Input Data with Filters</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../validators/">Checking Input Data with Validators</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../uploads/">Uploading Files with Forms</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../forms_advanced/">Advanced Usage of Forms</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../doctrine/">Database Management with Doctrine ORM</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../doctrine_migrations/">Database Migrations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../modules/">Creating a New Module</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Working with Sessions</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#php-sessions">PHP Sessions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#installing-laminassession-component">Installing Laminas\Session Component</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#session-manager">Session Manager</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#providing-session-configuration">Providing Session Configuration</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#making-the-session-manager-the-default-one">Making the Session Manager the Default One</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#session-containers">Session Containers</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#method-1-manual-instantiation-of-a-session-container">Method 1. Manual Instantiation of a Session Container</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#method-2-creating-a-session-container-using-factory">Method 2. Creating a Session Container Using Factory</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#saving-data-to-session-with-session-container">Saving Data to Session with Session Container</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../users/">User Management, Authentication and Access Filtering</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../roles/">Role-Based Access Control</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../devenv/">Appendix A. Configuring Web Development Environment</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../netbeans/">Appendix B. Introduction to PHP Development in NetBeans IDE</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../bootstrap/">Appendix C. Introduction to Twitter Bootstrap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../doctrine_intro/">Appendix D. Introduction to Doctrine</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ec2_tutorial/">Appendix E. Installing a Laminas Web Application to Amazon EC2</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Using Laminas Framework</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Working with Sessions</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/modir/laminas-book/edit/main/docs/session.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="working-with-sessions">Working with Sessions</h1>
<p>In this chapter, you will learn about <em>sessions</em>. The HTTP protocol is stateless, so you can't
share data between two HTTP requests by default. PHP sessions allow to workaround this by saving data on server during
one page request and retrieve it later during another page request. For example, you can remember
that the user has logged in, and show a personalized web page the next time he visits the website.
Laminas Framework internally uses the PHP sessions, but additionally provides a convenient wrapper around
PHP sessions, so you don't access <code>$_SESSION</code> super-global array directly.</p>
<p>Laminas components covered in this chapter:</p>
<table>
<thead>
<tr>
<th><em>Component</em></th>
<th><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>@<code>Laminas\Session</code></td>
<td>Implements a wrapper around PHP sessions.</td>
</tr>
</tbody>
</table>
<h2 id="php-sessions">PHP Sessions</h2>
<p>First, let's give some theory on what PHP sessions are. In PHP, sessions work as follows:</p>
<ul>
<li>when a site visitor opens the website for the first time, PHP sets a cookie <sup id="fnref:cookie"><a class="footnote-ref" href="#fn:cookie">1</a></sup> in the client browser.</li>
<li>the website may save any information to session with the help of special super-global array named <code>$_SESSION</code>. The
    data saved to session is stored on server in form of disk files.</li>
<li>when the same visitor opens the website again, the web browser sends the saved cookie to server, so PHP determines
    that this is the same visitor and loads the session data again to the <code>$_SESSION</code> array.</li>
</ul>
<p>From PHP application developer's point of view, the work with sessions is simple. First, initialise the session by
calling <code>session_start()</code> PHP function. Then, use <code>$_SESSION</code> super-global array for setting/retrieving session data.
For example, to save some data to session, use the following code:</p>
<pre><code class="language-php">session_start();
$_SESSION['my_var'] = 'Some data';
</code></pre>
<p>To later retrieve the data from session, use the following code:</p>
<pre><code class="language-php">session_start();
if (isset($_SESSION['my_var']))
    $sessionVar = $_SESSION['my_var'];
else
    $sessionVar = 'Some default value';
</code></pre>
<p>To clear the data, use the <code>unset()</code> PHP function, as follows:</p>
<pre><code class="language-php">unset($_SESSION['my_var']);
</code></pre>
<p>Note that sessions do not last forever (they expire sooner or later when the user's cookie expires or when PHP engine
cleans up the session storage files). How long the session lasts is defined in <em>php.ini</em> configuration file. It is possible to
override the default expiration parameters with the help of <code>ini_set()</code> function, as follows:</p>
<pre><code class="language-php">// Set session cookie lifetime (in seconds) to be 1 hour.
ini_set('session.cookie_lifetime', 60*60*1);

// Store session data on server for maximum 1 month.
ini_set('session.gc_maxlifetime', 60*60*24*30);
</code></pre>
<p>There are several other "advanced" session-related PHP configuration settings in <em>php.ini</em>. We do not
cover them here, because they are usually not needed.</p>
<blockquote>
<p><strong>So, if PHP sessions is so simple, why do I need additional wrapper provided by Laminas Framework?</strong></p>
<p>laminas-provided wrapper around the PHP sessions is useful, because:</p>
<ul>
<li>Laminas session wrapper is object-oriented, so you can use it consistently in your MVC application.</li>
<li>Laminas provides the concept of session namespaces, so different models can store data without naming conflicts.</li>
<li>Laminas provides security features (session validators), so it is more difficult for a malicious user to hack and substitute your session data.</li>
<li>Using <code>$_SESSION</code> super-global array directly is not good, because it makes testing your website more difficult. When you use a wrapper around PHP sessions, it is easier to supply test data.</li>
<li>With Laminas session classes, it is possible to implement custom session data storages (for example, store session data in database instead of files).</li>
</ul>
</blockquote>
<h2 id="installing-laminassession-component">Installing Laminas\Session Component</h2>
<p>In Laminas, the session functionality is implemented inside of @<code>Laminas\Session</code> component. If you haven't
yet installed this component in your web application, do this now with Composer by typing the following command:</p>
<pre><code>php composer.phar require laminas/laminas-session
</code></pre>
<p>The command above downloads the component code from GitHub and installs it in the <code>APP_DIR/vendor</code> directory.
It also injects the information about the installed module inside of your <code>APP_DIR/config/modules.config.php</code>
configuration file.</p>
<h2 id="session-manager">Session Manager</h2>
<p>Laminas provides a special service called @<code>SessionManager</code> which belongs to @<code>Laminas\Session</code> namespace. This service
is a usual Laminas service and is automatically registered in service manager. You can get an instance of the @<code>SessionManager</code>
service in a factory class with the following code:</p>
<pre><code class="language-php">// Use alias for the SessionManager class.
use Laminas\Session\SessionManager;

// Retrieve an instance of the session manager from the service manager.
$sessionManager = $container-&gt;get(SessionManager::class);
</code></pre>
<p>So, what does the @<code>SessionManager</code> do? Actually, it does everything for session to run.
The summary of its most useful methods is provided in the table 15.1 below:</p>
<table>
<thead>
<tr>
<th><em>Method</em></th>
<th><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sessionExists()</code></td>
<td>Checks whether session exists and currently active.</td>
</tr>
<tr>
<td><code>start($preserveStorage = false)</code></td>
<td>Starts the session (if not started yet).</td>
</tr>
<tr>
<td><code>destroy(array $options = null)</code></td>
<td>Ends the session.</td>
</tr>
<tr>
<td><code>getId()</code></td>
<td>Returns session ID.</td>
</tr>
<tr>
<td><code>setId()</code></td>
<td>Sets session ID.</td>
</tr>
<tr>
<td><code>regenerateId()</code></td>
<td>Regenerates the session ID.</td>
</tr>
<tr>
<td><code>getName()</code></td>
<td>Returns session name.</td>
</tr>
<tr>
<td><code>setName()</code></td>
<td>Overrides the default session name from <em>php.ini</em>.</td>
</tr>
<tr>
<td><code>rememberMe($ttl = null)</code></td>
<td>Sets session cookie lifetime (in seconds).</td>
</tr>
<tr>
<td><code>forgetMe()</code></td>
<td>Set a zero lifetime for the session cookie (the cookie will expire when browser is closed).</td>
</tr>
<tr>
<td><code>expireSessionCookie()</code></td>
<td>Expires the session cookie immediately.</td>
</tr>
<tr>
<td><code>isValid()</code></td>
<td>Executes session validators.</td>
</tr>
</tbody>
</table>
<p>Table 15.1. Methods provided by the SessionManager class</p>
<p>As you can see from the table above, the @<code>SessionManager</code> can start the session and end it, check if session exists, and set session parameters
(such as cookie expiration). It also provides a validator chain that may contain session validators (those
validators allow to prevent hacker attacks on session data).</p>
<h3 id="providing-session-configuration">Providing Session Configuration</h3>
<p>The @<code>SessionManager</code> class on initialization reads the application configuration,
so you can set up the session parameters conveniently. To do that, modify your <code>APP_DIR/config/autoload/global.php</code>
as follows:</p>
<pre><code class="language-php">&lt;?php
use Laminas\Session\Storage\SessionArrayStorage;
use Laminas\Session\Validator\RemoteAddr;
use Laminas\Session\Validator\HttpUserAgent;

return [
    // Session configuration.
    'session_config' =&gt; [
        // Session cookie will expire in 1 hour.
        'cookie_lifetime' =&gt; 60*60*1,
        // Session data will be stored on server maximum for 30 days.
        'gc_maxlifetime'     =&gt; 60*60*24*30,
    ],
    // Session manager configuration.
    'session_manager' =&gt; [
        // Session validators (used for security).
        'validators' =&gt; [
            RemoteAddr::class,
            HttpUserAgent::class,
        ]
    ],
    // Session storage configuration.
    'session_storage' =&gt; [
        'type' =&gt; SessionArrayStorage::class
    ],

    // ...
];
</code></pre>
<blockquote>
<p>We modify <code>global.php</code> file here, because sessions may be used by any module in your website and do not
depend on environment.</p>
</blockquote>
<p>As you can see, the session configuration is stored under three keys:</p>
<ul>
<li>
<p>The <code>session_config</code> key allows to define how long the session cookie will live and how long the PHP engine will
    store your session data on server.
    Actually, this key may contain additional session options, but we omit them for simplicity (if you'd like to override
    those advanced options, please refer to Laminas Framework documentation).</p>
</li>
<li>
<p>The <code>session_manager</code> key allows to set session validators. These are used to enhance the security. It is recommended
    that you always specify these validators here.</p>
</li>
<li>
<p>The <code>session_storage</code> key allows to specify the session storage class. We use the @<code>SessionArrayStorage</code> class, which
    is the default storage and is sufficient for the most cases.</p>
</li>
</ul>
<h3 id="making-the-session-manager-the-default-one">Making the Session Manager the Default One</h3>
<p>In Laminas, many components use the session manager implicitly (for example, @<code>FlashMessenger</code>[Laminas\Mvc\Plugin\FlashMessenger] controller plugin and view helper
uses session to save messages between HTTP requests). To let such components use the session manager you just configured, you'll have to make it
"the default one" by instantiating it as early as possible. For example, you can instantiate the session manager in your
module's <code>onBootstrap()</code> method, as follows:</p>
<pre><code class="language-php">&lt;?php
namespace Application;

use Laminas\Mvc\MvcEvent;
use Laminas\Session\SessionManager;

class Module
{
    //...

    /**
     * This method is called once the MVC bootstrapping is complete.
     */
    public function onBootstrap(MvcEvent $event)
    {
        $application = $event-&gt;getApplication();
        $serviceManager = $application-&gt;getServiceManager();

        // The following line instantiates the SessionManager and automatically
        // makes the SessionManager the 'default' one.
        $sessionManager = $serviceManager-&gt;get(SessionManager::class);
    }
}
</code></pre>
<blockquote>
<p>Making the session manager the default one is very important, because otherwise you'll have to explicitly pass it to every component
depending on the session manager, which is rather boring.</p>
</blockquote>
<h2 id="session-containers">Session Containers</h2>
<p>Once you have configured the session manager, you can actually store and retrieve data to/from session. To do that,
you use <em>session containers</em>. Session containers are implemented by the @<code>Container</code>[Laminas\Session\Container] class living in @<code>Laminas\Session</code> namespace.</p>
<p>The session container can be used to save your data to session and retrieve it from session. To avoid naming conflicts between
different classes, modules and components that use sessions, the session container allows you to specify the <em>namespace</em> under
which the data will be stored. A container namespace may contain upper-case and lower-case characters,
underscores and back-slashes. So, for example, "Session\ContainerName", "session_container_name" and "SessionContainerName" are all
valid container namespaces.</p>
<blockquote>
<p>Session containers work closely with the session manager. When you create a session container, it calls the session
manager's <code>start()</code> method automatically, so session is started and initialized.</p>
</blockquote>
<p>Now let's start using containers. You can create a container using two equivalent ways: either manually instantiating a container or
let a factory do that for you. The second one is easier, so we recommend it.</p>
<h3 id="method-1-manual-instantiation-of-a-session-container">Method 1. Manual Instantiation of a Session Container</h3>
<p>You can just create a session container with the <code>new</code> operator, but you need to pass an instance of
the session manager service to container's constructor:</p>
<pre><code class="language-php">use Laminas\Session\Container;

// We assume that $sessionManager variable is an instance of the session manager.
$sessionContainer = new Container('ContainerNamespace', $sessionManager);
</code></pre>
<p>So, before you create the container, be sure you have injected the session manager in your controller, service or wherever
you need to create the container.</p>
<h3 id="method-2-creating-a-session-container-using-factory">Method 2. Creating a Session Container Using Factory</h3>
<p>This method is equivalent to the first one, but the session container is created by the factory.
You just need to register what container namespaces you need. To do that,
add the <code>session_containers</code> key to your <code>module.config.php</code> file as follows:</p>
<pre><code class="language-php">&lt;?php
return [
    // ...
    'session_containers' =&gt; [
        'ContainerNamespace'
    ],
];
</code></pre>
<p>You may list the allowable container names under this key. Choosing a container name is up to you, just be sure it is unique among all other service names.</p>
<p>Once you registered a container name (or several container names), you can create the container and work with it.
You typically do that in a factory with the help of the service manager:</p>
<pre><code class="language-php">// The $container variable is the service manager.
$sessionContainer = $container-&gt;get('ContainerNamespace');
</code></pre>
<p>As you can see, you retrieve a session container from the service manager by its registered name.</p>
<h3 id="saving-data-to-session-with-session-container">Saving Data to Session with Session Container</h3>
<p>When you created the session container, you are able to save data to it as follows:</p>
<pre><code class="language-php">$sessionContainer-&gt;myVar = 'Some data';
</code></pre>
<p>To retrieve the data from session container, you use the following code:</p>
<pre><code class="language-php">if(isset($sessionContainer-&gt;myVar))
    $myVar = $sessionContainer-&gt;myVar;
else
    $myVar = null;
</code></pre>
<p>To remove data from session, use the following code:</p>
<pre><code class="language-php">unset($sessionContainer-&gt;myVar);
</code></pre>
<blockquote>
<p>For some practical examples of using session containers, please refer to <a href="#multi-step-forms">Implementing Multi-Step Forms</a>
   section.</p>
</blockquote>
<h2 id="summary">Summary</h2>
<p>PHP sessions is a useful feature allowing you to store some data between page requests. PHP engine stores session data on server
in form of files, and uses browser cookies to identify the same visitor the next time and load his session data to memory. For example, you can
remember the user and show him personalized pages. The session doesn't last forever - it expires in some time.</p>
<p>Laminas Framework provides a convenient wrapper around PHP sessions. With this wrapper, you can store data in session containers in object-oriented way.
Laminas also provides security features allowing to automatically validate session and prevent hacker attacks.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:cookie">
<p>An HTTP cookie is a small piece of data sent from a website and stored in the user's
web browser while the user is browsing. Cookies are used to remember some state between HTTP requests.&#160;<a class="footnote-backref" href="#fnref:cookie" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../modules/" class="btn btn-neutral float-left" title="Creating a New Module"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../users/" class="btn btn-neutral float-right" title="User Management, Authentication and Access Filtering">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/modir/laminas-book" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../modules/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../users/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
